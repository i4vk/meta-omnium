#!/bin/sh

META_OMNIUM_DIR=/mnt/homeGPU/igarzon/Meta-Learning/meta-omnium

# These are our primary 1-to-5 shot experiments. To run e.g. 5-shot experiments use `--k_shot_eval 5` instead of `--max_shots_eval 5`

# single task classification
ARGS=(
"--experiment_name maml_cls --best_hp_file_name maml_cls_hpo --model maml --n_way_eval 5 --max_shots_eval 5 --train_datasets BCT_Mini_Trn,BRD_Mini_Trn,CRS_Mini_Trn --val_id_datasets BCT_Mini_Val,BRD_Mini_Val,CRS_Mini_Val --val_od_datasets FLW_Mini,MD_MIX_Mini,PLK_Mini --test_id_datasets BCT_Mini_Test,BRD_Mini_Test,CRS_Mini_Test --test_od_datasets PLT_VIL_Mini,RESISC_Mini,SPT_Mini,TEX_Mini --T 5 --T_val 10 --T_test 10 --runs 1 --train_iters 30000 --eval_iters 600 --root_dir ${META_OMNIUM_DIR}"
"--experiment_name protomaml_cls --best_hp_file_name protomaml_cls_hpo --model protomaml --n_way_eval 5 --max_shots_eval 5 --train_datasets BCT_Mini_Trn,BRD_Mini_Trn,CRS_Mini_Trn --val_id_datasets BCT_Mini_Val,BRD_Mini_Val,CRS_Mini_Val --val_od_datasets FLW_Mini,MD_MIX_Mini,PLK_Mini --test_id_datasets BCT_Mini_Test,BRD_Mini_Test,CRS_Mini_Test --test_od_datasets PLT_VIL_Mini,RESISC_Mini,SPT_Mini,TEX_Mini --T 5 --T_val 10 --T_test 10 --runs 1 --train_iters 30000 --eval_iters 600 --root_dir ${META_OMNIUM_DIR}"
"--experiment_name metacurvature_cls --best_hp_file_name metacurvature_cls_hpo --model metacurvature --n_way_eval 5 --max_shots_eval 5 --train_datasets BCT_Mini_Trn,BRD_Mini_Trn,CRS_Mini_Trn --val_id_datasets BCT_Mini_Val,BRD_Mini_Val,CRS_Mini_Val --val_od_datasets FLW_Mini,MD_MIX_Mini,PLK_Mini --test_id_datasets BCT_Mini_Test,BRD_Mini_Test,CRS_Mini_Test --test_od_datasets PLT_VIL_Mini,RESISC_Mini,SPT_Mini,TEX_Mini --T 5 --T_val 10 --T_test 10 --runs 1 --train_iters 30000 --eval_iters 600 --root_dir ${META_OMNIUM_DIR}"
"--experiment_name protonet_cls --best_hp_file_name protonet_cls_hpo --model protonet --n_way_eval 5 --max_shots_eval 5 --train_datasets BCT_Mini_Trn,BRD_Mini_Trn,CRS_Mini_Trn --val_id_datasets BCT_Mini_Val,BRD_Mini_Val,CRS_Mini_Val --val_od_datasets FLW_Mini,MD_MIX_Mini,PLK_Mini --test_id_datasets BCT_Mini_Test,BRD_Mini_Test,CRS_Mini_Test --test_od_datasets PLT_VIL_Mini,RESISC_Mini,SPT_Mini,TEX_Mini --runs 1 --train_iters 30000 --eval_iters 600 --root_dir ${META_OMNIUM_DIR}"
"--experiment_name ddrr_cls --best_hp_file_name ddrr_cls_hpo --model ddrr --n_way_eval 5 --max_shots_eval 5 --train_datasets BCT_Mini_Trn,BRD_Mini_Trn,CRS_Mini_Trn --val_id_datasets BCT_Mini_Val,BRD_Mini_Val,CRS_Mini_Val --val_od_datasets FLW_Mini,MD_MIX_Mini,PLK_Mini --test_id_datasets BCT_Mini_Test,BRD_Mini_Test,CRS_Mini_Test --test_od_datasets PLT_VIL_Mini,RESISC_Mini,SPT_Mini,TEX_Mini --runs 1 --train_iters 30000 --eval_iters 600 --root_dir ${META_OMNIUM_DIR}"
"--experiment_name proto_finetuning_cls --best_hp_file_name proto_finetuning_cls_hpo --model proto_finetuning --n_way_eval 5 --max_shots_eval 5 --train_datasets BCT_Mini_Trn,BRD_Mini_Trn,CRS_Mini_Trn --val_id_datasets BCT_Mini_Val,BRD_Mini_Val,CRS_Mini_Val --val_od_datasets FLW_Mini,MD_MIX_Mini,PLK_Mini --test_id_datasets BCT_Mini_Test,BRD_Mini_Test,CRS_Mini_Test --test_od_datasets PLT_VIL_Mini,RESISC_Mini,SPT_Mini,TEX_Mini --T 20 --T_val 20 --T_test 20 --runs 1 --train_iters 30000 --eval_iters 600 --root_dir ${META_OMNIUM_DIR}"
"--experiment_name finetuning_cls --best_hp_file_name finetuning_cls_hpo --model finetuning --n_way_eval 5 --max_shots_eval 5 --train_datasets BCT_Mini_Trn,BRD_Mini_Trn,CRS_Mini_Trn --val_id_datasets BCT_Mini_Val,BRD_Mini_Val,CRS_Mini_Val --val_od_datasets FLW_Mini,MD_MIX_Mini,PLK_Mini --test_id_datasets BCT_Mini_Test,BRD_Mini_Test,CRS_Mini_Test --test_od_datasets PLT_VIL_Mini,RESISC_Mini,SPT_Mini,TEX_Mini --T 20 --T_val 20 --T_test 20 --runs 1 --train_iters 30000 --eval_iters 600 --root_dir ${META_OMNIUM_DIR}"
"--experiment_name linear_readout_cls --best_hp_file_name linear_readout_cls_hpo --model finetuning --n_way_eval 5 --max_shots_eval 5 --train_datasets BCT_Mini_Trn,BRD_Mini_Trn,CRS_Mini_Trn --val_id_datasets BCT_Mini_Val,BRD_Mini_Val,CRS_Mini_Val --val_od_datasets FLW_Mini,MD_MIX_Mini,PLK_Mini --test_id_datasets BCT_Mini_Test,BRD_Mini_Test,CRS_Mini_Test --test_od_datasets PLT_VIL_Mini,RESISC_Mini,SPT_Mini,TEX_Mini --T 20 --T_val 20 --T_test 20 --freeze --runs 1 --train_iters 30000 --eval_iters 600 --root_dir ${META_OMNIUM_DIR}"
"--experiment_name tfs_cls --best_hp_file_name tfs_cls_hpo --model tfs --n_way_eval 5 --max_shots_eval 5 --train_datasets BCT_Mini_Trn,BRD_Mini_Trn,CRS_Mini_Trn --val_id_datasets BCT_Mini_Val,BRD_Mini_Val,CRS_Mini_Val --val_od_datasets FLW_Mini,MD_MIX_Mini,PLK_Mini --test_id_datasets BCT_Mini_Test,BRD_Mini_Test,CRS_Mini_Test --test_od_datasets PLT_VIL_Mini,RESISC_Mini,SPT_Mini,TEX_Mini --T 20 --T_val 20 --T_test 20 --runs 1 --train_iters 30000 --eval_iters 600 --root_dir ${META_OMNIUM_DIR}"
)

for ARG in "${ARGS[@]}"
do
python metaomnium/trainers/train_cross_task_fsl.py ${ARG}
done